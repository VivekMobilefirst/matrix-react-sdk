{"version":3,"file":"index.js","names":["DefaultOptions","maxCount","speed","frameInterval","alpha","gradient","Confetti","constructor","options","window","requestAnimationFrame","Date","now","canvas","timeout","context","getContext","particles","count","length","push","resetParticle","width","height","isRunning","runAnimation","setTimeout","stop","particle","color","colors","Math","random","color2","x","y","diameter","tilt","tiltAngleIncrement","tiltAngle","PI","clearRect","delta","lastFrameTime","supportsAnimationFrame","updateParticles","drawParticles","x2","y2","beginPath","lineWidth","createLinearGradient","addColorStop","strokeStyle","moveTo","lineTo","stroke","waveAngle","i","sin","cos","splice"],"sources":["../../../src/effects/confetti/index.ts"],"sourcesContent":["/*\n Copyright 2020 Nurjin Jafar\n Copyright 2020 Nordeck IT + Consulting GmbH.\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n */\nimport ICanvasEffect from '../ICanvasEffect';\n\nexport type ConfettiOptions = {\n    /**\n     * max confetti count\n     */\n    maxCount: number;\n    /**\n     * particle animation speed\n     */\n    speed: number;\n    /**\n     * the confetti animation frame interval in milliseconds\n     */\n    frameInterval: number;\n    /**\n     * the alpha opacity of the confetti (between 0 and 1, where 1 is opaque and 0 is invisible)\n     */\n    alpha: number;\n    /**\n     * use gradient instead of solid particle color\n     */\n    gradient: boolean;\n};\n\ntype ConfettiParticle = {\n    color: string;\n    color2: string;\n    x: number;\n    y: number;\n    diameter: number;\n    tilt: number;\n    tiltAngleIncrement: number;\n    tiltAngle: number;\n};\n\nexport const DefaultOptions: ConfettiOptions = {\n    maxCount: 150,\n    speed: 3,\n    frameInterval: 15,\n    alpha: 1.0,\n    gradient: false,\n};\n\nexport default class Confetti implements ICanvasEffect {\n    private readonly options: ConfettiOptions;\n\n    constructor(options: { [key: string]: any }) {\n        this.options = { ...DefaultOptions, ...options };\n    }\n\n    private context: CanvasRenderingContext2D | null = null;\n    private supportsAnimationFrame = window.requestAnimationFrame;\n    private colors = ['rgba(30,144,255,', 'rgba(107,142,35,', 'rgba(255,215,0,',\n        'rgba(255,192,203,', 'rgba(106,90,205,', 'rgba(173,216,230,',\n        'rgba(238,130,238,', 'rgba(152,251,152,', 'rgba(70,130,180,',\n        'rgba(244,164,96,', 'rgba(210,105,30,', 'rgba(220,20,60,'];\n\n    private lastFrameTime = Date.now();\n    private particles: Array<ConfettiParticle> = [];\n    private waveAngle = 0;\n\n    public isRunning: boolean;\n\n    public start = async (canvas: HTMLCanvasElement, timeout = 3000) => {\n        if (!canvas) {\n            return;\n        }\n        this.context = canvas.getContext('2d');\n        this.particles = [];\n        const count = this.options.maxCount;\n        while (this.particles.length < count) {\n            this.particles.push(this.resetParticle({} as ConfettiParticle, canvas.width, canvas.height));\n        }\n        this.isRunning = true;\n        this.runAnimation();\n        if (timeout) {\n            window.setTimeout(this.stop, timeout);\n        }\n    };\n\n    public stop = async () => {\n        this.isRunning = false;\n    };\n\n    private resetParticle = (particle: ConfettiParticle, width: number, height: number): ConfettiParticle => {\n        particle.color = this.colors[(Math.random() * this.colors.length) | 0] + (this.options.alpha + ')');\n        if (this.options.gradient) {\n            particle.color2 = this.colors[(Math.random() * this.colors.length) | 0] + (this.options.alpha + ')');\n        } else {\n            particle.color2 = particle.color;\n        }\n        particle.x = Math.random() * width;\n        particle.y = Math.random() * -height;\n        particle.diameter = Math.random() * 10 + 5;\n        particle.tilt = Math.random() * -10;\n        particle.tiltAngleIncrement = Math.random() * 0.07 + 0.05;\n        particle.tiltAngle = Math.random() * Math.PI;\n        return particle;\n    };\n\n    private runAnimation = (): void => {\n        if (!this.context || !this.context.canvas) {\n            return;\n        }\n        if (this.particles.length === 0) {\n            this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n        } else {\n            const now = Date.now();\n            const delta = now - this.lastFrameTime;\n            if (!this.supportsAnimationFrame || delta > this.options.frameInterval) {\n                this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n                this.updateParticles();\n                this.drawParticles(this.context);\n                this.lastFrameTime = now - (delta % this.options.frameInterval);\n            }\n            requestAnimationFrame(this.runAnimation);\n        }\n    };\n\n    private drawParticles = (context: CanvasRenderingContext2D): void => {\n        if (!this.context || !this.context.canvas) {\n            return;\n        }\n        let x; let x2; let y2;\n        for (const particle of this.particles) {\n            this.context.beginPath();\n            context.lineWidth = particle.diameter;\n            x2 = particle.x + particle.tilt;\n            x = x2 + particle.diameter / 2;\n            y2 = particle.y + particle.tilt + particle.diameter / 2;\n            if (this.options.gradient) {\n                const gradient = context.createLinearGradient(x, particle.y, x2, y2);\n                gradient.addColorStop(0, particle.color);\n                gradient.addColorStop(1.0, particle.color2);\n                context.strokeStyle = gradient;\n            } else {\n                context.strokeStyle = particle.color;\n            }\n            context.moveTo(x, particle.y);\n            context.lineTo(x2, y2);\n            context.stroke();\n        }\n    };\n\n    private updateParticles = () => {\n        if (!this.context || !this.context.canvas) {\n            return;\n        }\n        const width = this.context.canvas.width;\n        const height = this.context.canvas.height;\n        let particle: ConfettiParticle;\n        this.waveAngle += 0.01;\n        for (let i = 0; i < this.particles.length; i++) {\n            particle = this.particles[i];\n            if (!this.isRunning && particle.y < -15) {\n                particle.y = height + 100;\n            } else {\n                particle.tiltAngle += particle.tiltAngleIncrement;\n                particle.x += Math.sin(this.waveAngle) - 0.5;\n                particle.y += (Math.cos(this.waveAngle) + particle.diameter + this.options.speed) * 0.5;\n                particle.tilt = Math.sin(particle.tiltAngle) * 15;\n            }\n            if (particle.x > width + 20 || particle.x < -20 || particle.y > height) {\n                if (this.isRunning && this.particles.length <= this.options.maxCount) {\n                    this.resetParticle(particle, width, height);\n                } else {\n                    this.particles.splice(i, 1);\n                    i--;\n                }\n            }\n        }\n    };\n}\n"],"mappings":"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"}