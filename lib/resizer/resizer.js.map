{"version":3,"file":"resizer.js","names":["Resizer","constructor","container","distributorCtor","config","event","resizeHandle","target","closest","classNames","handle","hasHandler","handler","parentElement","preventDefault","resizing","classList","add","onResizeStart","sizer","distributor","createSizerAndDistributor","start","onMouseMove","offset","offsetFromEvent","resizeFromContainerOffset","body","document","finishResize","remove","finish","onResizeStop","removeEventListener","addEventListener","throttle","distributors","getDistributors","forEach","d","trailing","leading","getResizeHandles","map","reverse","vertical","setClassNames","attach","attachment","onMouseDown","window","onResize","detach","forHandleAt","handleIndex","handles","forHandleWithId","id","find","h","getAttribute","isReverseResizeHandle","el","contains","isResizeHandle","Distributor","useItemContainer","undefined","createSizer","item","createItem","children","Array","from","querySelectorAll"],"sources":["../../src/resizer/resizer.ts"],"sourcesContent":["/*\nCopyright 2018 - 2020 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { throttle } from \"lodash\";\n\nimport FixedDistributor from \"./distributors/fixed\";\nimport ResizeItem from \"./item\";\nimport Sizer from \"./sizer\";\n\ninterface IClassNames {\n    // class on resize-handle\n    handle?: string;\n    // class on resize-handle\n    reverse?: string;\n    // class on resize-handle\n    vertical?: string;\n    // class on container\n    resizing?: string;\n}\n\nexport interface IConfig {\n    onResizeStart?(): void;\n    onResizeStop?(): void;\n    onResized?(size: number, id: string, element: HTMLElement): void;\n    handler?: HTMLDivElement;\n}\n\nexport default class Resizer<C extends IConfig = IConfig> {\n    private classNames: IClassNames;\n\n    // TODO move vertical/horizontal to config option/container class\n    // as it doesn't make sense to mix them within one container/Resizer\n    constructor(\n        public container: HTMLElement,\n        private readonly distributorCtor: {\n            new(item: ResizeItem): FixedDistributor<C, any>;\n            createItem(\n                resizeHandle: HTMLDivElement,\n                resizer: Resizer,\n                sizer: Sizer,\n                container: HTMLElement\n            ): ResizeItem;\n            createSizer(\n                containerElement: HTMLElement,\n                vertical: boolean,\n                reverse: boolean\n            ): Sizer;\n        },\n        public readonly config?: C,\n    ) {\n        this.classNames = {\n            handle: \"resizer-handle\",\n            reverse: \"resizer-reverse\",\n            vertical: \"resizer-vertical\",\n            resizing: \"resizer-resizing\",\n        };\n    }\n\n    public setClassNames(classNames: IClassNames) {\n        this.classNames = classNames;\n    }\n\n    public attach() {\n        const attachment = this?.config?.handler?.parentElement ?? this.container;\n        attachment.addEventListener(\"mousedown\", this.onMouseDown, false);\n        window.addEventListener(\"resize\", this.onResize);\n    }\n\n    public detach() {\n        const attachment = this?.config?.handler?.parentElement ?? this.container;\n        attachment.removeEventListener(\"mousedown\", this.onMouseDown, false);\n        window.removeEventListener(\"resize\", this.onResize);\n    }\n\n    /**\n    Gives the distributor for a specific resize handle, as if you would have started\n    to drag that handle. Can be used to manipulate the size of an item programmatically.\n    @param {number} handleIndex the index of the resize handle in the container\n    @return {FixedDistributor} a new distributor for the given handle\n    */\n    public forHandleAt(handleIndex: number): FixedDistributor<C> {\n        const handles = this.getResizeHandles();\n        const handle = handles[handleIndex];\n        if (handle) {\n            const { distributor } = this.createSizerAndDistributor(<HTMLDivElement>handle);\n            return distributor;\n        }\n    }\n\n    public forHandleWithId(id: string): FixedDistributor<C> {\n        const handles = this.getResizeHandles();\n        const handle = handles.find((h) => h.getAttribute(\"data-id\") === id);\n        if (handle) {\n            const { distributor } = this.createSizerAndDistributor(<HTMLDivElement>handle);\n            return distributor;\n        }\n    }\n\n    public isReverseResizeHandle(el: HTMLElement): boolean {\n        return el && el.classList.contains(this.classNames.reverse);\n    }\n\n    public isResizeHandle(el: HTMLElement): boolean {\n        return el && el.classList.contains(this.classNames.handle);\n    }\n\n    private onMouseDown = (event: MouseEvent) => {\n        // use closest in case the resize handle contains\n        // child dom nodes that can be the target\n        const resizeHandle = event.target && (<HTMLDivElement>event.target).closest(`.${this.classNames.handle}`);\n        const hasHandler = this?.config?.handler;\n        // prevent that stacked resizer's are both activated with one mouse event\n        // (this is possible because the mouse events are connected to the containers not the handles)\n        if (!resizeHandle || // if no resizeHandle exist / mouse event hit the container not the handle\n            (!hasHandler && resizeHandle.parentElement !== this.container) || // no handler from config -> check if the containers match\n            (hasHandler && resizeHandle !== hasHandler)) { // handler from config -> check if the handlers match\n            return;\n        }\n\n        // prevent starting a drag operation\n        event.preventDefault();\n\n        // mark as currently resizing\n        if (this.classNames.resizing) {\n            this.container?.classList?.add(this.classNames.resizing);\n        }\n        if (this.config.onResizeStart) {\n            this.config.onResizeStart();\n        }\n\n        const { sizer, distributor } = this.createSizerAndDistributor(<HTMLDivElement>resizeHandle);\n        distributor.start();\n\n        const onMouseMove = (event) => {\n            const offset = sizer.offsetFromEvent(event);\n            distributor.resizeFromContainerOffset(offset);\n        };\n\n        const body = document.body;\n        const finishResize = () => {\n            if (this.classNames.resizing) {\n                this.container?.classList?.remove(this.classNames.resizing);\n            }\n            distributor.finish();\n            if (this.config.onResizeStop) {\n                this.config.onResizeStop();\n            }\n            body.removeEventListener(\"mouseup\", finishResize, false);\n            document.removeEventListener(\"mouseleave\", finishResize, false);\n            body.removeEventListener(\"mousemove\", onMouseMove, false);\n        };\n        body.addEventListener(\"mouseup\", finishResize, false);\n        document.addEventListener(\"mouseleave\", finishResize, false);\n        body.addEventListener(\"mousemove\", onMouseMove, false);\n    };\n\n    private onResize = throttle(() => {\n        const distributors = this.getDistributors();\n\n        // relax all items if they had any overconstrained flexboxes\n        distributors.forEach(d => d.start());\n        distributors.forEach(d => d.finish());\n    }, 100, { trailing: true, leading: true });\n\n    public getDistributors = () => {\n        return this.getResizeHandles().map(handle => {\n            const { distributor } = this.createSizerAndDistributor(<HTMLDivElement>handle);\n            return distributor;\n        });\n    };\n\n    private createSizerAndDistributor(\n        resizeHandle: HTMLDivElement,\n    ): {sizer: Sizer, distributor: FixedDistributor<any>} {\n        const vertical = resizeHandle.classList.contains(this.classNames.vertical);\n        const reverse = this.isReverseResizeHandle(resizeHandle);\n        const Distributor = this.distributorCtor;\n        const useItemContainer = this.config && this.config.handler ? this.container : undefined;\n        const sizer = Distributor.createSizer(this.container, vertical, reverse);\n        const item = Distributor.createItem(resizeHandle, this, sizer, useItemContainer);\n        const distributor = new Distributor(item);\n        return { sizer, distributor };\n    }\n\n    private getResizeHandles(): HTMLElement[] {\n        if (this?.config?.handler) {\n            return [this.config.handler];\n        }\n        if (!this.container?.children) return [];\n        return Array.from(this.container.querySelectorAll(`.${this.classNames.handle}`));\n    }\n}\n"],"mappings":";;;;;;;;;;;AAgBA;;AAhBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA0Be,MAAMA,OAAN,CAA2C;EAGtD;EACA;EACAC,WAAW,CACAC,SADA,EAEUC,eAFV,EAgBSC,MAhBT,EAiBT;IAAA,KAhBSF,SAgBT,GAhBSA,SAgBT;IAAA,KAfmBC,eAenB,GAfmBA,eAenB;IAAA,KADkBC,MAClB,GADkBA,MAClB;IAAA;IAAA,mDAyDqBC,KAAD,IAAuB;MACzC;MACA;MACA,MAAMC,YAAY,GAAGD,KAAK,CAACE,MAAN,IAAiCF,KAAK,CAACE,MAAvB,CAA+BC,OAA/B,CAAwC,IAAG,KAAKC,UAAL,CAAgBC,MAAO,EAAlE,CAArC;MACA,MAAMC,UAAU,GAAG,MAAMP,MAAN,EAAcQ,OAAjC,CAJyC,CAKzC;MACA;;MACA,IAAI,CAACN,YAAD,IAAiB;MAChB,CAACK,UAAD,IAAeL,YAAY,CAACO,aAAb,KAA+B,KAAKX,SADpD,IACkE;MACjES,UAAU,IAAIL,YAAY,KAAKK,UAFpC,EAEiD;QAAE;QAC/C;MACH,CAXwC,CAazC;;;MACAN,KAAK,CAACS,cAAN,GAdyC,CAgBzC;;MACA,IAAI,KAAKL,UAAL,CAAgBM,QAApB,EAA8B;QAC1B,KAAKb,SAAL,EAAgBc,SAAhB,EAA2BC,GAA3B,CAA+B,KAAKR,UAAL,CAAgBM,QAA/C;MACH;;MACD,IAAI,KAAKX,MAAL,CAAYc,aAAhB,EAA+B;QAC3B,KAAKd,MAAL,CAAYc,aAAZ;MACH;;MAED,MAAM;QAAEC,KAAF;QAASC;MAAT,IAAyB,KAAKC,yBAAL,CAA+Cf,YAA/C,CAA/B;MACAc,WAAW,CAACE,KAAZ;;MAEA,MAAMC,WAAW,GAAIlB,KAAD,IAAW;QAC3B,MAAMmB,MAAM,GAAGL,KAAK,CAACM,eAAN,CAAsBpB,KAAtB,CAAf;QACAe,WAAW,CAACM,yBAAZ,CAAsCF,MAAtC;MACH,CAHD;;MAKA,MAAMG,IAAI,GAAGC,QAAQ,CAACD,IAAtB;;MACA,MAAME,YAAY,GAAG,MAAM;QACvB,IAAI,KAAKpB,UAAL,CAAgBM,QAApB,EAA8B;UAC1B,KAAKb,SAAL,EAAgBc,SAAhB,EAA2Bc,MAA3B,CAAkC,KAAKrB,UAAL,CAAgBM,QAAlD;QACH;;QACDK,WAAW,CAACW,MAAZ;;QACA,IAAI,KAAK3B,MAAL,CAAY4B,YAAhB,EAA8B;UAC1B,KAAK5B,MAAL,CAAY4B,YAAZ;QACH;;QACDL,IAAI,CAACM,mBAAL,CAAyB,SAAzB,EAAoCJ,YAApC,EAAkD,KAAlD;QACAD,QAAQ,CAACK,mBAAT,CAA6B,YAA7B,EAA2CJ,YAA3C,EAAyD,KAAzD;QACAF,IAAI,CAACM,mBAAL,CAAyB,WAAzB,EAAsCV,WAAtC,EAAmD,KAAnD;MACH,CAXD;;MAYAI,IAAI,CAACO,gBAAL,CAAsB,SAAtB,EAAiCL,YAAjC,EAA+C,KAA/C;MACAD,QAAQ,CAACM,gBAAT,CAA0B,YAA1B,EAAwCL,YAAxC,EAAsD,KAAtD;MACAF,IAAI,CAACO,gBAAL,CAAsB,WAAtB,EAAmCX,WAAnC,EAAgD,KAAhD;IACH,CAzGC;IAAA,gDA2GiB,IAAAY,gBAAA,EAAS,MAAM;MAC9B,MAAMC,YAAY,GAAG,KAAKC,eAAL,EAArB,CAD8B,CAG9B;;MACAD,YAAY,CAACE,OAAb,CAAqBC,CAAC,IAAIA,CAAC,CAACjB,KAAF,EAA1B;MACAc,YAAY,CAACE,OAAb,CAAqBC,CAAC,IAAIA,CAAC,CAACR,MAAF,EAA1B;IACH,CANkB,EAMhB,GANgB,EAMX;MAAES,QAAQ,EAAE,IAAZ;MAAkBC,OAAO,EAAE;IAA3B,CANW,CA3GjB;IAAA,uDAmHuB,MAAM;MAC3B,OAAO,KAAKC,gBAAL,GAAwBC,GAAxB,CAA4BjC,MAAM,IAAI;QACzC,MAAM;UAAEU;QAAF,IAAkB,KAAKC,yBAAL,CAA+CX,MAA/C,CAAxB;QACA,OAAOU,WAAP;MACH,CAHM,CAAP;IAIH,CAxHC;IACE,KAAKX,UAAL,GAAkB;MACdC,MAAM,EAAE,gBADM;MAEdkC,OAAO,EAAE,iBAFK;MAGdC,QAAQ,EAAE,kBAHI;MAId9B,QAAQ,EAAE;IAJI,CAAlB;EAMH;;EAEM+B,aAAa,CAACrC,UAAD,EAA0B;IAC1C,KAAKA,UAAL,GAAkBA,UAAlB;EACH;;EAEMsC,MAAM,GAAG;IACZ,MAAMC,UAAU,GAAG,MAAM5C,MAAN,EAAcQ,OAAd,EAAuBC,aAAvB,IAAwC,KAAKX,SAAhE;IACA8C,UAAU,CAACd,gBAAX,CAA4B,WAA5B,EAAyC,KAAKe,WAA9C,EAA2D,KAA3D;IACAC,MAAM,CAAChB,gBAAP,CAAwB,QAAxB,EAAkC,KAAKiB,QAAvC;EACH;;EAEMC,MAAM,GAAG;IACZ,MAAMJ,UAAU,GAAG,MAAM5C,MAAN,EAAcQ,OAAd,EAAuBC,aAAvB,IAAwC,KAAKX,SAAhE;IACA8C,UAAU,CAACf,mBAAX,CAA+B,WAA/B,EAA4C,KAAKgB,WAAjD,EAA8D,KAA9D;IACAC,MAAM,CAACjB,mBAAP,CAA2B,QAA3B,EAAqC,KAAKkB,QAA1C;EACH;EAED;AACJ;AACA;AACA;AACA;AACA;;;EACWE,WAAW,CAACC,WAAD,EAA2C;IACzD,MAAMC,OAAO,GAAG,KAAKb,gBAAL,EAAhB;IACA,MAAMhC,MAAM,GAAG6C,OAAO,CAACD,WAAD,CAAtB;;IACA,IAAI5C,MAAJ,EAAY;MACR,MAAM;QAAEU;MAAF,IAAkB,KAAKC,yBAAL,CAA+CX,MAA/C,CAAxB;MACA,OAAOU,WAAP;IACH;EACJ;;EAEMoC,eAAe,CAACC,EAAD,EAAkC;IACpD,MAAMF,OAAO,GAAG,KAAKb,gBAAL,EAAhB;IACA,MAAMhC,MAAM,GAAG6C,OAAO,CAACG,IAAR,CAAcC,CAAD,IAAOA,CAAC,CAACC,YAAF,CAAe,SAAf,MAA8BH,EAAlD,CAAf;;IACA,IAAI/C,MAAJ,EAAY;MACR,MAAM;QAAEU;MAAF,IAAkB,KAAKC,yBAAL,CAA+CX,MAA/C,CAAxB;MACA,OAAOU,WAAP;IACH;EACJ;;EAEMyC,qBAAqB,CAACC,EAAD,EAA2B;IACnD,OAAOA,EAAE,IAAIA,EAAE,CAAC9C,SAAH,CAAa+C,QAAb,CAAsB,KAAKtD,UAAL,CAAgBmC,OAAtC,CAAb;EACH;;EAEMoB,cAAc,CAACF,EAAD,EAA2B;IAC5C,OAAOA,EAAE,IAAIA,EAAE,CAAC9C,SAAH,CAAa+C,QAAb,CAAsB,KAAKtD,UAAL,CAAgBC,MAAtC,CAAb;EACH;;EAmEOW,yBAAyB,CAC7Bf,YAD6B,EAEqB;IAClD,MAAMuC,QAAQ,GAAGvC,YAAY,CAACU,SAAb,CAAuB+C,QAAvB,CAAgC,KAAKtD,UAAL,CAAgBoC,QAAhD,CAAjB;IACA,MAAMD,OAAO,GAAG,KAAKiB,qBAAL,CAA2BvD,YAA3B,CAAhB;IACA,MAAM2D,WAAW,GAAG,KAAK9D,eAAzB;IACA,MAAM+D,gBAAgB,GAAG,KAAK9D,MAAL,IAAe,KAAKA,MAAL,CAAYQ,OAA3B,GAAqC,KAAKV,SAA1C,GAAsDiE,SAA/E;IACA,MAAMhD,KAAK,GAAG8C,WAAW,CAACG,WAAZ,CAAwB,KAAKlE,SAA7B,EAAwC2C,QAAxC,EAAkDD,OAAlD,CAAd;IACA,MAAMyB,IAAI,GAAGJ,WAAW,CAACK,UAAZ,CAAuBhE,YAAvB,EAAqC,IAArC,EAA2Ca,KAA3C,EAAkD+C,gBAAlD,CAAb;IACA,MAAM9C,WAAW,GAAG,IAAI6C,WAAJ,CAAgBI,IAAhB,CAApB;IACA,OAAO;MAAElD,KAAF;MAASC;IAAT,CAAP;EACH;;EAEOsB,gBAAgB,GAAkB;IACtC,IAAI,MAAMtC,MAAN,EAAcQ,OAAlB,EAA2B;MACvB,OAAO,CAAC,KAAKR,MAAL,CAAYQ,OAAb,CAAP;IACH;;IACD,IAAI,CAAC,KAAKV,SAAL,EAAgBqE,QAArB,EAA+B,OAAO,EAAP;IAC/B,OAAOC,KAAK,CAACC,IAAN,CAAW,KAAKvE,SAAL,CAAewE,gBAAf,CAAiC,IAAG,KAAKjE,UAAL,CAAgBC,MAAO,EAA3D,CAAX,CAAP;EACH;;AAnKqD"}