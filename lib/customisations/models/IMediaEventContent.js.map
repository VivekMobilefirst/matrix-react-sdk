{"version":3,"file":"IMediaEventContent.js","names":["prepEventContentAsMedia","content","thumbnail","info","thumbnail_url","mxc","file","thumbnail_file","url","Error"],"sources":["../../../src/customisations/models/IMediaEventContent.ts"],"sourcesContent":["/*\n * Copyright 2021 The Matrix.org Foundation C.I.C.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// TODO: These types should be elsewhere.\n\nexport interface IEncryptedFile {\n    url: string;\n    key: {\n        alg: string;\n        key_ops: string[]; // eslint-disable-line camelcase\n        kty: string;\n        k: string;\n        ext: boolean;\n    };\n    iv: string;\n    hashes: {[alg: string]: string};\n    v: string;\n}\n\nexport interface IMediaEventInfo {\n    thumbnail_url?: string; // eslint-disable-line camelcase\n    thumbnail_file?: IEncryptedFile; // eslint-disable-line camelcase\n    thumbnail_info?: { // eslint-disable-line camelcase\n        mimetype: string;\n        w?: number;\n        h?: number;\n        size?: number;\n    };\n    mimetype: string;\n    w?: number;\n    h?: number;\n    size?: number;\n}\n\nexport interface IMediaEventContent {\n    body?: string;\n    filename?: string; // `m.file` optional field\n    url?: string; // required on unencrypted media\n    file?: IEncryptedFile; // required for *encrypted* media\n    info?: IMediaEventInfo;\n}\n\nexport interface IPreparedMedia extends IMediaObject {\n    thumbnail?: IMediaObject;\n}\n\nexport interface IMediaObject {\n    mxc: string;\n    file?: IEncryptedFile;\n}\n\n/**\n * Parses an event content body into a prepared media object. This prepared media object\n * can be used with other functions to manipulate the media.\n * @param {IMediaEventContent} content Unredacted media event content. See interface.\n * @returns {IPreparedMedia} A prepared media object.\n * @throws Throws if the given content cannot be packaged into a prepared media object.\n */\nexport function prepEventContentAsMedia(content: IMediaEventContent): IPreparedMedia {\n    let thumbnail: IMediaObject = null;\n    if (content?.info?.thumbnail_url) {\n        thumbnail = {\n            mxc: content.info.thumbnail_url,\n            file: content.info.thumbnail_file,\n        };\n    } else if (content?.info?.thumbnail_file?.url) {\n        thumbnail = {\n            mxc: content.info.thumbnail_file.url,\n            file: content.info.thumbnail_file,\n        };\n    }\n\n    if (content?.url) {\n        return {\n            thumbnail,\n            mxc: content.url,\n            file: content.file,\n        };\n    } else if (content?.file?.url) {\n        return {\n            thumbnail,\n            mxc: content.file.url,\n            file: content.file,\n        };\n    }\n\n    throw new Error(\"Invalid file provided: cannot determine MXC URI. Has it been redacted?\");\n}\n"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAgDA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,uBAAT,CAAiCC,OAAjC,EAA8E;EACjF,IAAIC,SAAuB,GAAG,IAA9B;;EACA,IAAID,OAAO,EAAEE,IAAT,EAAeC,aAAnB,EAAkC;IAC9BF,SAAS,GAAG;MACRG,GAAG,EAAEJ,OAAO,CAACE,IAAR,CAAaC,aADV;MAERE,IAAI,EAAEL,OAAO,CAACE,IAAR,CAAaI;IAFX,CAAZ;EAIH,CALD,MAKO,IAAIN,OAAO,EAAEE,IAAT,EAAeI,cAAf,EAA+BC,GAAnC,EAAwC;IAC3CN,SAAS,GAAG;MACRG,GAAG,EAAEJ,OAAO,CAACE,IAAR,CAAaI,cAAb,CAA4BC,GADzB;MAERF,IAAI,EAAEL,OAAO,CAACE,IAAR,CAAaI;IAFX,CAAZ;EAIH;;EAED,IAAIN,OAAO,EAAEO,GAAb,EAAkB;IACd,OAAO;MACHN,SADG;MAEHG,GAAG,EAAEJ,OAAO,CAACO,GAFV;MAGHF,IAAI,EAAEL,OAAO,CAACK;IAHX,CAAP;EAKH,CAND,MAMO,IAAIL,OAAO,EAAEK,IAAT,EAAeE,GAAnB,EAAwB;IAC3B,OAAO;MACHN,SADG;MAEHG,GAAG,EAAEJ,OAAO,CAACK,IAAR,CAAaE,GAFf;MAGHF,IAAI,EAAEL,OAAO,CAACK;IAHX,CAAP;EAKH;;EAED,MAAM,IAAIG,KAAJ,CAAU,wEAAV,CAAN;AACH"}