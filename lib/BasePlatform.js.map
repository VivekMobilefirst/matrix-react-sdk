{"version":3,"file":"BasePlatform.js","names":["SSO_HOMESERVER_URL_KEY","SSO_ID_SERVER_URL_KEY","SSO_IDP_ID_KEY","UpdateCheckStatus","UPDATE_DEFER_KEY","BasePlatform","constructor","payload","action","Action","OnLoggedOut","setNotificationCount","dis","register","onAction","startUpdateCheck","bind","count","notificationCount","setErrorStatus","errorDidOccur","canSelfUpdate","hideUpdateToast","localStorage","removeItem","dispatch","CheckUpdates","status","Checking","installUpdate","shouldShowUpdate","newVersion","MatrixClientPeg","userRegisteredWithinLastHours","version","deferUntil","JSON","parse","getItem","Date","now","e","deferUpdate","date","setHours","setItem","stringify","getTime","supportsSpellCheckSettings","allowOverridingNativeContextMenus","supportsNotifications","maySendNotifications","displayNotification","title","msg","avatarUrl","room","ev","notifBody","body","silent","notification","window","Notification","onclick","ViewRoom","room_id","roomId","metricsTrigger","getThread","event_id","getId","focus","loudNotification","clearNotification","notif","close","needsUrlTooltips","supportsSetting","settingName","getSettingValue","undefined","setSettingValue","value","Error","getEventIndexingManager","setLanguage","preferredLangs","setSpellCheckEnabled","enabled","getSpellCheckEnabled","setSpellCheckLanguages","getSpellCheckLanguages","getDesktopCapturerSources","options","supportsDesktopCapturer","supportsJitsiScreensharing","overrideBrowserShortcuts","navigateForwardBack","back","getAvailableSpellCheckLanguages","getSSOCallbackUrl","fragmentAfterLogin","url","URL","location","href","hash","startSingleSignOn","mxClient","loginType","idpId","getHomeserverUrl","getIdentityServerUrl","callbackUrl","getSsoLoginUrl","toString","getPickleKey","userId","deviceId","crypto","subtle","data","idbLoad","logger","error","encrypted","iv","cryptoKey","additionalData","Uint8Array","length","i","charCodeAt","key","decrypt","name","encodeUnpaddedBase64","createPickleKey","randomArray","getRandomValues","generateKey","encrypt","idbSave","destroyPickleKey","idbDelete"],"sources":["../src/BasePlatform.ts"],"sourcesContent":["/*\nCopyright 2016 Aviral Dasgupta\nCopyright 2016 OpenMarket Ltd\nCopyright 2018 New Vector Ltd\nCopyright 2020 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { MatrixClient } from \"matrix-js-sdk/src/client\";\nimport { encodeUnpaddedBase64 } from \"matrix-js-sdk/src/crypto/olmlib\";\nimport { logger } from \"matrix-js-sdk/src/logger\";\nimport { MatrixEvent } from \"matrix-js-sdk/src/models/event\";\nimport { Room } from \"matrix-js-sdk/src/models/room\";\n\nimport dis from './dispatcher/dispatcher';\nimport BaseEventIndexManager from './indexing/BaseEventIndexManager';\nimport { ActionPayload } from \"./dispatcher/payloads\";\nimport { CheckUpdatesPayload } from \"./dispatcher/payloads/CheckUpdatesPayload\";\nimport { Action } from \"./dispatcher/actions\";\nimport { hideToast as hideUpdateToast } from \"./toasts/UpdateToast\";\nimport { MatrixClientPeg } from \"./MatrixClientPeg\";\nimport { idbLoad, idbSave, idbDelete } from \"./utils/StorageManager\";\nimport { ViewRoomPayload } from \"./dispatcher/payloads/ViewRoomPayload\";\nimport { IConfigOptions } from \"./IConfigOptions\";\n\nexport const SSO_HOMESERVER_URL_KEY = \"mx_sso_hs_url\";\nexport const SSO_ID_SERVER_URL_KEY = \"mx_sso_is_url\";\nexport const SSO_IDP_ID_KEY = \"mx_sso_idp_id\";\n\nexport enum UpdateCheckStatus {\n    Checking = \"CHECKING\",\n    Error = \"ERROR\",\n    NotAvailable = \"NOTAVAILABLE\",\n    Downloading = \"DOWNLOADING\",\n    Ready = \"READY\",\n}\n\nexport interface UpdateStatus {\n    /**\n     * The current phase of the manual update check.\n     */\n    status: UpdateCheckStatus;\n    /**\n     * Detail string relating to the current status, typically for error details.\n     */\n    detail?: string;\n}\n\nconst UPDATE_DEFER_KEY = \"mx_defer_update\";\n\n/**\n * Base class for classes that provide platform-specific functionality\n * eg. Setting an application badge or displaying notifications\n *\n * Instances of this class are provided by the application.\n */\nexport default abstract class BasePlatform {\n    protected notificationCount = 0;\n    protected errorDidOccur = false;\n\n    constructor() {\n        dis.register(this.onAction);\n        this.startUpdateCheck = this.startUpdateCheck.bind(this);\n    }\n\n    public abstract getConfig(): Promise<IConfigOptions>;\n\n    public abstract getDefaultDeviceDisplayName(): string;\n\n    protected onAction = (payload: ActionPayload): void => {\n        switch (payload.action) {\n            case 'on_client_not_viable':\n            case Action.OnLoggedOut:\n                this.setNotificationCount(0);\n                break;\n        }\n    };\n\n    // Used primarily for Analytics\n    public abstract getHumanReadableName(): string;\n\n    public setNotificationCount(count: number): void {\n        this.notificationCount = count;\n    }\n\n    public setErrorStatus(errorDidOccur: boolean): void {\n        this.errorDidOccur = errorDidOccur;\n    }\n\n    /**\n     * Whether we can call checkForUpdate on this platform build\n     */\n    public async canSelfUpdate(): Promise<boolean> {\n        return false;\n    }\n\n    public startUpdateCheck(): void {\n        hideUpdateToast();\n        localStorage.removeItem(UPDATE_DEFER_KEY);\n        dis.dispatch<CheckUpdatesPayload>({\n            action: Action.CheckUpdates,\n            status: UpdateCheckStatus.Checking,\n        });\n    }\n\n    /**\n     * Update the currently running app to the latest available version\n     * and replace this instance of the app with the new version.\n     */\n    public installUpdate(): void {}\n\n    /**\n     * Check if the version update has been deferred and that deferment is still in effect\n     * @param newVersion the version string to check\n     */\n    protected shouldShowUpdate(newVersion: string): boolean {\n        // If the user registered on this client in the last 24 hours then do not show them the update toast\n        if (MatrixClientPeg.userRegisteredWithinLastHours(24)) return false;\n\n        try {\n            const [version, deferUntil] = JSON.parse(localStorage.getItem(UPDATE_DEFER_KEY));\n            return newVersion !== version || Date.now() > deferUntil;\n        } catch (e) {\n            return true;\n        }\n    }\n\n    /**\n     * Ignore the pending update and don't prompt about this version\n     * until the next morning (8am).\n     */\n    public deferUpdate(newVersion: string): void {\n        const date = new Date(Date.now() + 24 * 60 * 60 * 1000);\n        date.setHours(8, 0, 0, 0); // set to next 8am\n        localStorage.setItem(UPDATE_DEFER_KEY, JSON.stringify([newVersion, date.getTime()]));\n        hideUpdateToast();\n    }\n\n    /**\n     * Return true if platform supports multi-language\n     * spell-checking, otherwise false.\n     */\n    public supportsSpellCheckSettings(): boolean {\n        return false;\n    }\n\n    /**\n     * Returns true if platform allows overriding native context menus\n     */\n    public allowOverridingNativeContextMenus(): boolean {\n        return false;\n    }\n\n    /**\n     * Returns true if the platform supports displaying\n     * notifications, otherwise false.\n     * @returns {boolean} whether the platform supports displaying notifications\n     */\n    public supportsNotifications(): boolean {\n        return false;\n    }\n\n    /**\n     * Returns true if the application currently has permission\n     * to display notifications. Otherwise false.\n     * @returns {boolean} whether the application has permission to display notifications\n     */\n    public maySendNotifications(): boolean {\n        return false;\n    }\n\n    /**\n     * Requests permission to send notifications. Returns\n     * a promise that is resolved when the user has responded\n     * to the request. The promise has a single string argument\n     * that is 'granted' if the user allowed the request or\n     * 'denied' otherwise.\n     */\n    public abstract requestNotificationPermission(): Promise<string>;\n\n    public displayNotification(\n        title: string,\n        msg: string,\n        avatarUrl: string,\n        room: Room,\n        ev?: MatrixEvent,\n    ): Notification {\n        const notifBody = {\n            body: msg,\n            silent: true, // we play our own sounds\n        };\n        if (avatarUrl) notifBody['icon'] = avatarUrl;\n        const notification = new window.Notification(title, notifBody);\n\n        notification.onclick = () => {\n            const payload: ViewRoomPayload = {\n                action: Action.ViewRoom,\n                room_id: room.roomId,\n                metricsTrigger: \"Notification\",\n            };\n\n            if (ev.getThread()) {\n                payload.event_id = ev.getId();\n            }\n\n            dis.dispatch(payload);\n            window.focus();\n        };\n\n        return notification;\n    }\n\n    public loudNotification(ev: MatrixEvent, room: Room): void {}\n\n    public clearNotification(notif: Notification): void {\n        // Some browsers don't support this, e.g Safari on iOS\n        // https://developer.mozilla.org/en-US/docs/Web/API/Notification/close\n        if (notif.close) {\n            notif.close();\n        }\n    }\n\n    /**\n     * Returns true if the platform requires URL previews in tooltips, otherwise false.\n     * @returns {boolean} whether the platform requires URL previews in tooltips\n     */\n    public needsUrlTooltips(): boolean {\n        return false;\n    }\n\n    /**\n     * Returns a promise that resolves to a string representing the current version of the application.\n     */\n    public abstract getAppVersion(): Promise<string>;\n\n    /**\n     * Restarts the application, without necessarily reloading\n     * any application code\n     */\n    public abstract reload(): void;\n\n    public supportsSetting(settingName?: string): boolean {\n        return false;\n    }\n\n    public getSettingValue(settingName: string): Promise<any> {\n        return undefined;\n    }\n\n    public setSettingValue(settingName: string, value: any): Promise<void> {\n        throw new Error(\"Unimplemented\");\n    }\n\n    /**\n     * Get our platform specific EventIndexManager.\n     *\n     * @return {BaseEventIndexManager} The EventIndex manager for our platform,\n     * can be null if the platform doesn't support event indexing.\n     */\n    public getEventIndexingManager(): BaseEventIndexManager | null {\n        return null;\n    }\n\n    public setLanguage(preferredLangs: string[]) {}\n\n    public setSpellCheckEnabled(enabled: boolean): void {}\n\n    public async getSpellCheckEnabled(): Promise<boolean> {\n        return null;\n    }\n\n    public setSpellCheckLanguages(preferredLangs: string[]) {}\n\n    public getSpellCheckLanguages(): Promise<string[]> | null {\n        return null;\n    }\n\n    public async getDesktopCapturerSources(options: GetSourcesOptions): Promise<Array<DesktopCapturerSource>> {\n        return [];\n    }\n\n    public supportsDesktopCapturer(): boolean {\n        return false;\n    }\n\n    public supportsJitsiScreensharing(): boolean {\n        return true;\n    }\n\n    public overrideBrowserShortcuts(): boolean {\n        return false;\n    }\n\n    public navigateForwardBack(back: boolean): void {}\n\n    public getAvailableSpellCheckLanguages(): Promise<string[]> | null {\n        return null;\n    }\n\n    protected getSSOCallbackUrl(fragmentAfterLogin: string): URL {\n        const url = new URL(window.location.href);\n        url.hash = fragmentAfterLogin || \"\";\n        return url;\n    }\n\n    /**\n     * Begin Single Sign On flows.\n     * @param {MatrixClient} mxClient the matrix client using which we should start the flow\n     * @param {\"sso\"|\"cas\"} loginType the type of SSO it is, CAS/SSO.\n     * @param {string} fragmentAfterLogin the hash to pass to the app during sso callback.\n     * @param {string} idpId The ID of the Identity Provider being targeted, optional.\n     */\n    public startSingleSignOn(\n        mxClient: MatrixClient,\n        loginType: \"sso\" | \"cas\",\n        fragmentAfterLogin: string,\n        idpId?: string,\n    ): void {\n        // persist hs url and is url for when the user is returned to the app with the login token\n        localStorage.setItem(SSO_HOMESERVER_URL_KEY, mxClient.getHomeserverUrl());\n        if (mxClient.getIdentityServerUrl()) {\n            localStorage.setItem(SSO_ID_SERVER_URL_KEY, mxClient.getIdentityServerUrl());\n        }\n        if (idpId) {\n            localStorage.setItem(SSO_IDP_ID_KEY, idpId);\n        }\n        const callbackUrl = this.getSSOCallbackUrl(fragmentAfterLogin);\n        window.location.href = mxClient.getSsoLoginUrl(callbackUrl.toString(), loginType, idpId); // redirect to SSO\n    }\n\n    /**\n     * Get a previously stored pickle key.  The pickle key is used for\n     * encrypting libolm objects.\n     * @param {string} userId the user ID for the user that the pickle key is for.\n     * @param {string} userId the device ID that the pickle key is for.\n     * @returns {string|null} the previously stored pickle key, or null if no\n     *     pickle key has been stored.\n     */\n    public async getPickleKey(userId: string, deviceId: string): Promise<string | null> {\n        if (!window.crypto || !window.crypto.subtle) {\n            return null;\n        }\n        let data;\n        try {\n            data = await idbLoad(\"pickleKey\", [userId, deviceId]);\n        } catch (e) {\n            logger.error(\"idbLoad for pickleKey failed\", e);\n        }\n        if (!data) {\n            return null;\n        }\n        if (!data.encrypted || !data.iv || !data.cryptoKey) {\n            logger.error(\"Badly formatted pickle key\");\n            return null;\n        }\n\n        const additionalData = new Uint8Array(userId.length + deviceId.length + 1);\n        for (let i = 0; i < userId.length; i++) {\n            additionalData[i] = userId.charCodeAt(i);\n        }\n        additionalData[userId.length] = 124; // \"|\"\n        for (let i = 0; i < deviceId.length; i++) {\n            additionalData[userId.length + 1 + i] = deviceId.charCodeAt(i);\n        }\n\n        try {\n            const key = await crypto.subtle.decrypt(\n                { name: \"AES-GCM\", iv: data.iv, additionalData }, data.cryptoKey,\n                data.encrypted,\n            );\n            return encodeUnpaddedBase64(key);\n        } catch (e) {\n            logger.error(\"Error decrypting pickle key\");\n            return null;\n        }\n    }\n\n    /**\n     * Create and store a pickle key for encrypting libolm objects.\n     * @param {string} userId the user ID for the user that the pickle key is for.\n     * @param {string} deviceId the device ID that the pickle key is for.\n     * @returns {string|null} the pickle key, or null if the platform does not\n     *     support storing pickle keys.\n     */\n    public async createPickleKey(userId: string, deviceId: string): Promise<string | null> {\n        if (!window.crypto || !window.crypto.subtle) {\n            return null;\n        }\n        const crypto = window.crypto;\n        const randomArray = new Uint8Array(32);\n        crypto.getRandomValues(randomArray);\n        const cryptoKey = await crypto.subtle.generateKey(\n            { name: \"AES-GCM\", length: 256 }, false, [\"encrypt\", \"decrypt\"],\n        );\n        const iv = new Uint8Array(32);\n        crypto.getRandomValues(iv);\n\n        const additionalData = new Uint8Array(userId.length + deviceId.length + 1);\n        for (let i = 0; i < userId.length; i++) {\n            additionalData[i] = userId.charCodeAt(i);\n        }\n        additionalData[userId.length] = 124; // \"|\"\n        for (let i = 0; i < deviceId.length; i++) {\n            additionalData[userId.length + 1 + i] = deviceId.charCodeAt(i);\n        }\n\n        const encrypted = await crypto.subtle.encrypt(\n            { name: \"AES-GCM\", iv, additionalData }, cryptoKey, randomArray,\n        );\n\n        try {\n            await idbSave(\"pickleKey\", [userId, deviceId], { encrypted, iv, cryptoKey });\n        } catch (e) {\n            return null;\n        }\n        return encodeUnpaddedBase64(randomArray);\n    }\n\n    /**\n     * Delete a previously stored pickle key from storage.\n     * @param {string} userId the user ID for the user that the pickle key is for.\n     * @param {string} userId the device ID that the pickle key is for.\n     */\n    public async destroyPickleKey(userId: string, deviceId: string): Promise<void> {\n        try {\n            await idbDelete(\"pickleKey\", [userId, deviceId]);\n        } catch (e) {\n            logger.error(\"idbDelete failed in destroyPickleKey\", e);\n        }\n    }\n}\n"],"mappings":"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"}