{"version":3,"file":"MatrixClientPeg.js","names":["MatrixClientPegClass","initialSyncLimit","get","matrixClient","unset","MatrixActionCreators","stop","setJustRegisteredUserId","uid","justRegisteredUserId","registrationTime","Date","now","toString","window","localStorage","setItem","currentUserIsJustRegistered","credentials","userId","userRegisteredWithinLastHours","hours","parseInt","getItem","diff","e","userRegisteredAfter","timestamp","getTime","replaceUsingCreds","creds","currentClientCreds","createClient","assign","dbType","promise","store","startup","logger","log","err","error","MemoryStore","SettingsStore","getValue","initCrypto","setCryptoTrustCrossSignedDevices","tryToUnlockSecretStorageWithDehydrationKey","StorageManager","setCryptoInitialised","name","Modal","createDialog","CryptoStoreTooNewDialog","warn","opts","utils","deepCopy","pendingEventOrdering","PendingEventOrdering","Detached","lazyLoadMembers","clientWellKnownPollPeriod","experimentalThreadSupport","start","MatrixClientBackedSettingsHandler","startClient","getCredentials","copiedCredentials","homeserverUrl","baseUrl","identityServerUrl","idBaseUrl","deviceId","getDeviceId","accessToken","getAccessToken","guest","isGuest","getHomeserverName","matches","exec","length","Error","pickleKey","timelineSupport","forceTURN","fallbackICEServerAllowed","iceCandidatePoolSize","verificationMethods","SAS","SHOW_QR_CODE_METHOD","RECIPROCATE_QR_CODE","identityServer","IdentityAuthClient","cryptoCallbacks","Object","crossSigningCallbacks","SecurityCustomisations","getDehydrationKey","createMatrixClient","setMaxListeners","setGuest","Boolean","notifTimelineSet","EventTimelineSet","pendingEvents","getLiveTimeline","setPaginationToken","EventTimeline","BACKWARDS","setNotifTimelineSet","MatrixClientPeg","mxMatrixClientPeg"],"sources":["../src/MatrixClientPeg.ts"],"sourcesContent":["/*\nCopyright 2015, 2016 OpenMarket Ltd\nCopyright 2017 Vector Creations Ltd.\nCopyright 2017, 2018, 2019 New Vector Ltd\nCopyright 2019, 2020 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { ICreateClientOpts, PendingEventOrdering } from 'matrix-js-sdk/src/matrix';\nimport { IStartClientOpts, MatrixClient } from 'matrix-js-sdk/src/client';\nimport { MemoryStore } from 'matrix-js-sdk/src/store/memory';\nimport * as utils from 'matrix-js-sdk/src/utils';\nimport { EventTimeline } from 'matrix-js-sdk/src/models/event-timeline';\nimport { EventTimelineSet } from 'matrix-js-sdk/src/models/event-timeline-set';\nimport { verificationMethods } from 'matrix-js-sdk/src/crypto';\nimport { SHOW_QR_CODE_METHOD } from \"matrix-js-sdk/src/crypto/verification/QRCode\";\nimport { logger } from \"matrix-js-sdk/src/logger\";\n\nimport createMatrixClient from './utils/createMatrixClient';\nimport SettingsStore from './settings/SettingsStore';\nimport MatrixActionCreators from './actions/MatrixActionCreators';\nimport Modal from './Modal';\nimport MatrixClientBackedSettingsHandler from \"./settings/handlers/MatrixClientBackedSettingsHandler\";\nimport * as StorageManager from './utils/StorageManager';\nimport IdentityAuthClient from './IdentityAuthClient';\nimport { crossSigningCallbacks, tryToUnlockSecretStorageWithDehydrationKey } from './SecurityManager';\nimport SecurityCustomisations from \"./customisations/Security\";\nimport CryptoStoreTooNewDialog from \"./components/views/dialogs/CryptoStoreTooNewDialog\";\n\nexport interface IMatrixClientCreds {\n    homeserverUrl: string;\n    identityServerUrl?: string;\n    userId: string;\n    deviceId?: string;\n    accessToken: string;\n    guest?: boolean;\n    pickleKey?: string;\n    freshLogin?: boolean;\n}\n\n/**\n * Holds the current instance of the `MatrixClient` to use across the codebase.\n * Looking for an `MatrixClient`? Just look for the `MatrixClientPeg` on the peg\n * board. \"Peg\" is the literal meaning of something you hang something on. So\n * you'll find a `MatrixClient` hanging on the `MatrixClientPeg`.\n */\nexport interface IMatrixClientPeg {\n    opts: IStartClientOpts;\n\n    /**\n     * Return the server name of the user's homeserver\n     * Throws an error if unable to deduce the homeserver name\n     * (eg. if the user is not logged in)\n     *\n     * @returns {string} The homeserver name, if present.\n     */\n    getHomeserverName(): string;\n\n    get(): MatrixClient;\n    unset(): void;\n    assign(): Promise<any>;\n    start(): Promise<any>;\n\n    getCredentials(): IMatrixClientCreds;\n\n    /**\n     * If we've registered a user ID we set this to the ID of the\n     * user we've just registered. If they then go & log in, we\n     * can send them to the welcome user (obviously this doesn't\n     * guarantee they'll get a chat with the welcome user).\n     *\n     * @param {string} uid The user ID of the user we've just registered\n     */\n    setJustRegisteredUserId(uid: string | null): void;\n\n    /**\n     * Returns true if the current user has just been registered by this\n     * client as determined by setJustRegisteredUserId()\n     *\n     * @returns {bool} True if user has just been registered\n     */\n    currentUserIsJustRegistered(): boolean;\n\n    /**\n     * If the current user has been registered by this device then this\n     * returns a boolean of whether it was within the last N hours given.\n     */\n    userRegisteredWithinLastHours(hours: number): boolean;\n\n    /**\n     * If the current user has been registered by this device then this\n     * returns a boolean of whether it was after a given timestamp.\n     */\n    userRegisteredAfter(date: Date): boolean;\n\n    /**\n     * Replace this MatrixClientPeg's client with a client instance that has\n     * homeserver / identity server URLs and active credentials\n     *\n     * @param {IMatrixClientCreds} creds The new credentials to use.\n     */\n    replaceUsingCreds(creds: IMatrixClientCreds): void;\n}\n\n/**\n * Wrapper object for handling the js-sdk Matrix Client object in the react-sdk\n * Handles the creation/initialisation of client objects.\n * This module provides a singleton instance of this class so the 'current'\n * Matrix Client object is available easily.\n */\nclass MatrixClientPegClass implements IMatrixClientPeg {\n    // These are the default options used when when the\n    // client is started in 'start'. These can be altered\n    // at any time up to after the 'will_start_client'\n    // event is finished processing.\n    public opts: IStartClientOpts = {\n        initialSyncLimit: 20,\n    };\n\n    private matrixClient: MatrixClient = null;\n    private justRegisteredUserId: string | null = null;\n\n    // the credentials used to init the current client object.\n    // used if we tear it down & recreate it with a different store\n    private currentClientCreds: IMatrixClientCreds;\n\n    public get(): MatrixClient {\n        return this.matrixClient;\n    }\n\n    public unset(): void {\n        this.matrixClient = null;\n\n        MatrixActionCreators.stop();\n    }\n\n    public setJustRegisteredUserId(uid: string | null): void {\n        this.justRegisteredUserId = uid;\n        if (uid) {\n            const registrationTime = Date.now().toString();\n            window.localStorage.setItem(\"mx_registration_time\", registrationTime);\n        }\n    }\n\n    public currentUserIsJustRegistered(): boolean {\n        return (\n            this.matrixClient &&\n            this.matrixClient.credentials.userId === this.justRegisteredUserId\n        );\n    }\n\n    public userRegisteredWithinLastHours(hours: number): boolean {\n        if (hours <= 0) {\n            return false;\n        }\n\n        try {\n            const registrationTime = parseInt(window.localStorage.getItem(\"mx_registration_time\"), 10);\n            const diff = Date.now() - registrationTime;\n            return (diff / 36e5) <= hours;\n        } catch (e) {\n            return false;\n        }\n    }\n\n    public userRegisteredAfter(timestamp: Date): boolean {\n        try {\n            const registrationTime = parseInt(window.localStorage.getItem(\"mx_registration_time\"), 10);\n            return timestamp.getTime() <= registrationTime;\n        } catch (e) {\n            return false;\n        }\n    }\n\n    public replaceUsingCreds(creds: IMatrixClientCreds): void {\n        this.currentClientCreds = creds;\n        this.createClient(creds);\n    }\n\n    public async assign(): Promise<any> {\n        for (const dbType of ['indexeddb', 'memory']) {\n            try {\n                const promise = this.matrixClient.store.startup();\n                logger.log(\"MatrixClientPeg: waiting for MatrixClient store to initialise\");\n                await promise;\n                break;\n            } catch (err) {\n                if (dbType === 'indexeddb') {\n                    logger.error('Error starting matrixclient store - falling back to memory store', err);\n                    this.matrixClient.store = new MemoryStore({\n                        localStorage: localStorage,\n                    });\n                } else {\n                    logger.error('Failed to start memory store!', err);\n                    throw err;\n                }\n            }\n        }\n\n        // try to initialise e2e on the new client\n        try {\n            // check that we have a version of the js-sdk which includes initCrypto\n            if (!SettingsStore.getValue(\"lowBandwidth\") && this.matrixClient.initCrypto) {\n                await this.matrixClient.initCrypto();\n                this.matrixClient.setCryptoTrustCrossSignedDevices(\n                    !SettingsStore.getValue('e2ee.manuallyVerifyAllSessions'),\n                );\n                await tryToUnlockSecretStorageWithDehydrationKey(this.matrixClient);\n                StorageManager.setCryptoInitialised(true);\n            }\n        } catch (e) {\n            if (e && e.name === 'InvalidCryptoStoreError') {\n                // The js-sdk found a crypto DB too new for it to use\n                Modal.createDialog(CryptoStoreTooNewDialog);\n            }\n            // this can happen for a number of reasons, the most likely being\n            // that the olm library was missing. It's not fatal.\n            logger.warn(\"Unable to initialise e2e\", e);\n        }\n\n        const opts = utils.deepCopy(this.opts);\n        // the react sdk doesn't work without this, so don't allow\n        opts.pendingEventOrdering = PendingEventOrdering.Detached;\n        opts.lazyLoadMembers = true;\n        opts.clientWellKnownPollPeriod = 2 * 60 * 60; // 2 hours\n        opts.experimentalThreadSupport = SettingsStore.getValue(\"feature_thread\");\n\n        // Connect the matrix client to the dispatcher and setting handlers\n        MatrixActionCreators.start(this.matrixClient);\n        MatrixClientBackedSettingsHandler.matrixClient = this.matrixClient;\n\n        return opts;\n    }\n\n    public async start(): Promise<any> {\n        const opts = await this.assign();\n\n        logger.log(`MatrixClientPeg: really starting MatrixClient`);\n        await this.get().startClient(opts);\n        logger.log(`MatrixClientPeg: MatrixClient started`);\n    }\n\n    public getCredentials(): IMatrixClientCreds {\n        let copiedCredentials = this.currentClientCreds;\n        if (this.currentClientCreds?.userId !== this.matrixClient?.credentials?.userId) {\n            // cached credentials belong to a different user - don't use them\n            copiedCredentials = null;\n        }\n        return {\n            // Copy the cached credentials before overriding what we can.\n            ...(copiedCredentials ?? {}),\n\n            homeserverUrl: this.matrixClient.baseUrl,\n            identityServerUrl: this.matrixClient.idBaseUrl,\n            userId: this.matrixClient.credentials.userId,\n            deviceId: this.matrixClient.getDeviceId(),\n            accessToken: this.matrixClient.getAccessToken(),\n            guest: this.matrixClient.isGuest(),\n        };\n    }\n\n    public getHomeserverName(): string {\n        const matches = /^@[^:]+:(.+)$/.exec(this.matrixClient.credentials.userId);\n        if (matches === null || matches.length < 1) {\n            throw new Error(\"Failed to derive homeserver name from user ID!\");\n        }\n        return matches[1];\n    }\n\n    private createClient(creds: IMatrixClientCreds): void {\n        const opts: ICreateClientOpts = {\n            baseUrl: creds.homeserverUrl,\n            idBaseUrl: creds.identityServerUrl,\n            accessToken: creds.accessToken,\n            userId: creds.userId,\n            deviceId: creds.deviceId,\n            pickleKey: creds.pickleKey,\n            timelineSupport: true,\n            forceTURN: !SettingsStore.getValue('webRtcAllowPeerToPeer'),\n            fallbackICEServerAllowed: !!SettingsStore.getValue('fallbackICEServerAllowed'),\n            // Gather up to 20 ICE candidates when a call arrives: this should be more than we'd\n            // ever normally need, so effectively this should make all the gathering happen when\n            // the call arrives.\n            iceCandidatePoolSize: 20,\n            verificationMethods: [\n                verificationMethods.SAS,\n                SHOW_QR_CODE_METHOD,\n                verificationMethods.RECIPROCATE_QR_CODE,\n            ],\n            identityServer: new IdentityAuthClient(),\n            cryptoCallbacks: {},\n        };\n\n        // These are always installed regardless of the labs flag so that\n        // cross-signing features can toggle on without reloading and also be\n        // accessed immediately after login.\n        Object.assign(opts.cryptoCallbacks, crossSigningCallbacks);\n        if (SecurityCustomisations.getDehydrationKey) {\n            opts.cryptoCallbacks.getDehydrationKey =\n                SecurityCustomisations.getDehydrationKey;\n        }\n\n        this.matrixClient = createMatrixClient(opts);\n\n        // we're going to add eventlisteners for each matrix event tile, so the\n        // potential number of event listeners is quite high.\n        this.matrixClient.setMaxListeners(500);\n\n        this.matrixClient.setGuest(Boolean(creds.guest));\n\n        const notifTimelineSet = new EventTimelineSet(null, {\n            timelineSupport: true,\n            pendingEvents: false,\n        });\n        // XXX: what is our initial pagination token?! it somehow needs to be synchronised with /sync.\n        notifTimelineSet.getLiveTimeline().setPaginationToken(\"\", EventTimeline.BACKWARDS);\n        this.matrixClient.setNotifTimelineSet(notifTimelineSet);\n    }\n}\n\n/**\n * Note: You should be using a React context with access to a client rather than\n * using this, as in a multi-account world this will not exist!\n */\nexport const MatrixClientPeg: IMatrixClientPeg = new MatrixClientPegClass();\n\nif (!window.mxMatrixClientPeg) {\n    window.mxMatrixClientPeg = MatrixClientPeg;\n}\n"],"mappings":"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"}