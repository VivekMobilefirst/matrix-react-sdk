{"version":3,"file":"parts.js","names":["Type","BasePart","constructor","text","_text","acceptsInsertion","chr","offset","inputType","acceptsRemoval","position","merge","part","split","splitText","slice","PlainPart","remove","len","strWithRemoval","i","charAt","appendUntilRejected","str","length","buffer","char","undefined","validateAndInsert","beforeInsert","afterInsert","createAutoComplete","updateCallback","trim","remaining","canEdit","acceptsCaret","toString","type","serialize","PlainBasePart","EMOJIBASE_REGEX","test","toDOMNode","document","createTextNode","updateDOMNode","node","textContent","canUpdateDOMNode","nodeType","Node","TEXT_NODE","Plain","PillPart","resourceId","label","container","createElement","setAttribute","onclick","onClick","className","appendChild","setAvatar","textNode","childNodes","ELEMENT_NODE","nodeName","setAvatarVars","avatarUrl","initialLetter","avatarBackground","avatarLetter","style","getPropertyValue","setProperty","NewlinePart","tagName","Newline","EmojiPart","span","unicodeToShortcode","Emoji","RoomPillPart","room","Avatar","avatarUrlForRoom","getInitialLetter","name","defaultAvatarUrlForString","roomId","RoomPill","isSpaceRoom","AtRoomPillPart","AtRoomPill","UserPillPart","userId","displayName","member","defaultDispatcher","dispatch","action","Action","ViewUser","UserPill","defaultAvatarUrl","avatarUrlForMember","PillCandidatePart","autoCompleteCreator","create","PillCandidate","getAutoCompleteCreator","getAutocompleterComponent","updateQuery","partCreator","AutocompleteWrapperModel","PartCreator","client","setAutoCompleteCreator","createPartForInput","input","partIndex","pillCandidate","createDefaultPart","plain","deserializePart","newline","emoji","atRoomPill","roomPill","userPill","alias","getRoom","getRooms","find","r","getCanonicalAlias","getAltAliases","includes","getMember","plainWithEmoji","parts","plainText","push","createMentionParts","insertTrailingCharacter","pill","SettingsStore","getValue","postfix","CommandPartCreator","command","CommandPart","Command"],"sources":["../../src/editor/parts.ts"],"sourcesContent":["/*\nCopyright 2019 New Vector Ltd\nCopyright 2019 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { split } from \"lodash\";\nimport EMOJIBASE_REGEX from \"emojibase-regex\";\nimport { MatrixClient } from \"matrix-js-sdk/src/client\";\nimport { RoomMember } from \"matrix-js-sdk/src/models/room-member\";\nimport { Room } from \"matrix-js-sdk/src/models/room\";\n\nimport AutocompleteWrapperModel, {\n    GetAutocompleterComponent,\n    UpdateCallback,\n    UpdateQuery,\n} from \"./autocomplete\";\nimport { unicodeToShortcode } from \"../HtmlUtils\";\nimport * as Avatar from \"../Avatar\";\nimport defaultDispatcher from \"../dispatcher/dispatcher\";\nimport { Action } from \"../dispatcher/actions\";\nimport SettingsStore from \"../settings/SettingsStore\";\n\ninterface ISerializedPart {\n    type: Type.Plain | Type.Newline | Type.Emoji | Type.Command | Type.PillCandidate;\n    text: string;\n}\n\ninterface ISerializedPillPart {\n    type: Type.AtRoomPill | Type.RoomPill | Type.UserPill;\n    text: string;\n    resourceId?: string;\n}\n\nexport type SerializedPart = ISerializedPart | ISerializedPillPart;\n\nexport enum Type {\n    Plain = \"plain\",\n    Newline = \"newline\",\n    Emoji = \"emoji\",\n    Command = \"command\",\n    UserPill = \"user-pill\",\n    RoomPill = \"room-pill\",\n    AtRoomPill = \"at-room-pill\",\n    PillCandidate = \"pill-candidate\",\n}\n\ninterface IBasePart {\n    text: string;\n    type: Type.Plain | Type.Newline | Type.Emoji;\n    canEdit: boolean;\n    acceptsCaret: boolean;\n\n    createAutoComplete(updateCallback: UpdateCallback): void;\n\n    serialize(): SerializedPart;\n    remove(offset: number, len: number): string | undefined;\n    split(offset: number): IBasePart;\n    validateAndInsert(offset: number, str: string, inputType: string): boolean;\n    appendUntilRejected(str: string, inputType: string): string | undefined;\n    updateDOMNode(node: Node): void;\n    canUpdateDOMNode(node: Node): boolean;\n    toDOMNode(): Node;\n}\n\ninterface IPillCandidatePart extends Omit<IBasePart, \"type\" | \"createAutoComplete\"> {\n    type: Type.PillCandidate | Type.Command;\n    createAutoComplete(updateCallback: UpdateCallback): AutocompleteWrapperModel;\n}\n\ninterface IPillPart extends Omit<IBasePart, \"type\" | \"resourceId\"> {\n    type: Type.AtRoomPill | Type.RoomPill | Type.UserPill;\n    resourceId: string;\n}\n\nexport type Part = IBasePart | IPillCandidatePart | IPillPart;\n\nabstract class BasePart {\n    protected _text: string;\n\n    constructor(text = \"\") {\n        this._text = text;\n    }\n\n    // chr can also be a grapheme cluster\n    protected acceptsInsertion(chr: string, offset: number, inputType: string): boolean {\n        return true;\n    }\n\n    protected acceptsRemoval(position: number, chr: string): boolean {\n        return true;\n    }\n\n    public merge(part: Part): boolean {\n        return false;\n    }\n\n    public split(offset: number): IBasePart {\n        const splitText = this.text.slice(offset);\n        this._text = this.text.slice(0, offset);\n        return new PlainPart(splitText);\n    }\n\n    // removes len chars, or returns the plain text this part should be replaced with\n    // if the part would become invalid if it removed everything.\n    public remove(offset: number, len: number): string | undefined {\n        // validate\n        const strWithRemoval = this.text.slice(0, offset) + this.text.slice(offset + len);\n        for (let i = offset; i < (len + offset); ++i) {\n            const chr = this.text.charAt(i);\n            if (!this.acceptsRemoval(i, chr)) {\n                return strWithRemoval;\n            }\n        }\n        this._text = strWithRemoval;\n    }\n\n    // append str, returns the remaining string if a character was rejected.\n    public appendUntilRejected(str: string, inputType: string): string | undefined {\n        const offset = this.text.length;\n        // Take a copy as we will be taking chunks off the start of the string as we process them\n        // To only need to grapheme split the bits of the string we're working on.\n        let buffer = str;\n        while (buffer) {\n            // We use lodash's grapheme splitter to avoid breaking apart compound emojis\n            const [char] = split(buffer, \"\", 2);\n            if (!this.acceptsInsertion(char, offset + str.length - buffer.length, inputType)) {\n                break;\n            }\n            buffer = buffer.slice(char.length);\n        }\n\n        this._text += str.slice(0, str.length - buffer.length);\n        return buffer || undefined;\n    }\n\n    // inserts str at offset if all the characters in str were accepted, otherwise don't do anything\n    // return whether the str was accepted or not.\n    public validateAndInsert(offset: number, str: string, inputType: string): boolean {\n        for (let i = 0; i < str.length; ++i) {\n            const chr = str.charAt(i);\n            if (!this.acceptsInsertion(chr, offset + i, inputType)) {\n                return false;\n            }\n        }\n        const beforeInsert = this._text.slice(0, offset);\n        const afterInsert = this._text.slice(offset);\n        this._text = beforeInsert + str + afterInsert;\n        return true;\n    }\n\n    public createAutoComplete(updateCallback: UpdateCallback): void {}\n\n    protected trim(len: number): string {\n        const remaining = this._text.slice(len);\n        this._text = this._text.slice(0, len);\n        return remaining;\n    }\n\n    public get text(): string {\n        return this._text;\n    }\n\n    public abstract get type(): Type;\n\n    public get canEdit(): boolean {\n        return true;\n    }\n\n    public get acceptsCaret(): boolean {\n        return this.canEdit;\n    }\n\n    public toString(): string {\n        return `${this.type}(${this.text})`;\n    }\n\n    public serialize(): SerializedPart {\n        return {\n            type: this.type as ISerializedPart[\"type\"],\n            text: this.text,\n        };\n    }\n\n    public abstract updateDOMNode(node: Node): void;\n    public abstract canUpdateDOMNode(node: Node): boolean;\n    public abstract toDOMNode(): Node;\n}\n\nabstract class PlainBasePart extends BasePart {\n    protected acceptsInsertion(chr: string, offset: number, inputType: string): boolean {\n        if (chr === \"\\n\" || EMOJIBASE_REGEX.test(chr)) {\n            return false;\n        }\n        // when not pasting or dropping text, reject characters that should start a pill candidate\n        if (inputType !== \"insertFromPaste\" && inputType !== \"insertFromDrop\") {\n            if (chr !== \"@\" && chr !== \"#\" && chr !== \":\" && chr !== \"+\") {\n                return true;\n            }\n\n            // split if we are at the beginning of the part text\n            if (offset === 0) {\n                return false;\n            }\n\n            // or split if the previous character is a space\n            // or if it is a + and this is a :\n            return this._text[offset - 1] !== \" \" &&\n                (this._text[offset - 1] !== \"+\" || chr !== \":\");\n        }\n        return true;\n    }\n\n    public toDOMNode(): Node {\n        return document.createTextNode(this.text);\n    }\n\n    public merge(part): boolean {\n        if (part.type === this.type) {\n            this._text = this.text + part.text;\n            return true;\n        }\n        return false;\n    }\n\n    public updateDOMNode(node: Node): void {\n        if (node.textContent !== this.text) {\n            node.textContent = this.text;\n        }\n    }\n\n    public canUpdateDOMNode(node: Node): boolean {\n        return node.nodeType === Node.TEXT_NODE;\n    }\n}\n\n// exported for unit tests, should otherwise only be used through PartCreator\nexport class PlainPart extends PlainBasePart implements IBasePart {\n    public get type(): IBasePart[\"type\"] {\n        return Type.Plain;\n    }\n}\n\nexport abstract class PillPart extends BasePart implements IPillPart {\n    constructor(public resourceId: string, label) {\n        super(label);\n    }\n\n    protected acceptsInsertion(chr: string): boolean {\n        return chr !== \" \";\n    }\n\n    protected acceptsRemoval(position: number, chr: string): boolean {\n        return position !== 0;  //if you remove initial # or @, pill should become plain\n    }\n\n    public toDOMNode(): Node {\n        const container = document.createElement(\"span\");\n        container.setAttribute(\"spellcheck\", \"false\");\n        container.setAttribute(\"contentEditable\", \"false\");\n        container.onclick = this.onClick;\n        container.className = this.className;\n        container.appendChild(document.createTextNode(this.text));\n        this.setAvatar(container);\n        return container;\n    }\n\n    public updateDOMNode(node: HTMLElement): void {\n        const textNode = node.childNodes[0];\n        if (textNode.textContent !== this.text) {\n            textNode.textContent = this.text;\n        }\n        if (node.className !== this.className) {\n            node.className = this.className;\n        }\n        if (node.onclick !== this.onClick) {\n            node.onclick = this.onClick;\n        }\n        this.setAvatar(node);\n    }\n\n    public canUpdateDOMNode(node: HTMLElement): boolean {\n        return node.nodeType === Node.ELEMENT_NODE &&\n               node.nodeName === \"SPAN\" &&\n               node.childNodes.length === 1 &&\n               node.childNodes[0].nodeType === Node.TEXT_NODE;\n    }\n\n    // helper method for subclasses\n    protected setAvatarVars(node: HTMLElement, avatarUrl: string, initialLetter: string): void {\n        const avatarBackground = `url('${avatarUrl}')`;\n        const avatarLetter = `'${initialLetter}'`;\n        // check if the value is changing,\n        // otherwise the avatars flicker on every keystroke while updating.\n        if (node.style.getPropertyValue(\"--avatar-background\") !== avatarBackground) {\n            node.style.setProperty(\"--avatar-background\", avatarBackground);\n        }\n        if (node.style.getPropertyValue(\"--avatar-letter\") !== avatarLetter) {\n            node.style.setProperty(\"--avatar-letter\", avatarLetter);\n        }\n    }\n\n    public serialize(): ISerializedPillPart {\n        return {\n            type: this.type,\n            text: this.text,\n            resourceId: this.resourceId,\n        };\n    }\n\n    public get canEdit(): boolean {\n        return false;\n    }\n\n    public abstract get type(): IPillPart[\"type\"];\n\n    protected abstract get className(): string;\n\n    protected onClick?: () => void;\n\n    protected abstract setAvatar(node: HTMLElement): void;\n}\n\nclass NewlinePart extends BasePart implements IBasePart {\n    protected acceptsInsertion(chr: string, offset: number): boolean {\n        return offset === 0 && chr === \"\\n\";\n    }\n\n    protected acceptsRemoval(position: number, chr: string): boolean {\n        return true;\n    }\n\n    public toDOMNode(): Node {\n        return document.createElement(\"br\");\n    }\n\n    public merge(): boolean {\n        return false;\n    }\n\n    public updateDOMNode(): void {}\n\n    public canUpdateDOMNode(node: HTMLElement): boolean {\n        return node.tagName === \"BR\";\n    }\n\n    public get type(): IBasePart[\"type\"] {\n        return Type.Newline;\n    }\n\n    // this makes the cursor skip this part when it is inserted\n    // rather than trying to append to it, which is what we want.\n    // As a newline can also be only one character, it makes sense\n    // as it can only be one character long. This caused #9741.\n    public get canEdit(): boolean {\n        return false;\n    }\n}\n\nexport class EmojiPart extends BasePart implements IBasePart {\n    protected acceptsInsertion(chr: string, offset: number): boolean {\n        return EMOJIBASE_REGEX.test(chr);\n    }\n\n    protected acceptsRemoval(position: number, chr: string): boolean {\n        return false;\n    }\n\n    public toDOMNode(): Node {\n        const span = document.createElement(\"span\");\n        span.className = \"mx_Emoji\";\n        span.setAttribute(\"title\", unicodeToShortcode(this.text));\n        span.appendChild(document.createTextNode(this.text));\n        return span;\n    }\n\n    public updateDOMNode(node: HTMLElement): void {\n        const textNode = node.childNodes[0];\n        if (textNode.textContent !== this.text) {\n            node.setAttribute(\"title\", unicodeToShortcode(this.text));\n            textNode.textContent = this.text;\n        }\n    }\n\n    public canUpdateDOMNode(node: HTMLElement): boolean {\n        return node.className === \"mx_Emoji\";\n    }\n\n    public get type(): IBasePart[\"type\"] {\n        return Type.Emoji;\n    }\n\n    public get canEdit(): boolean {\n        return false;\n    }\n\n    public get acceptsCaret(): boolean {\n        return true;\n    }\n}\n\nclass RoomPillPart extends PillPart {\n    constructor(resourceId: string, label: string, private room: Room) {\n        super(resourceId, label);\n    }\n\n    protected setAvatar(node: HTMLElement): void {\n        let initialLetter = \"\";\n        let avatarUrl = Avatar.avatarUrlForRoom(this.room, 16, 16, \"crop\");\n        if (!avatarUrl) {\n            initialLetter = Avatar.getInitialLetter(this.room ? this.room.name : this.resourceId);\n            avatarUrl = Avatar.defaultAvatarUrlForString(this.room ? this.room.roomId : this.resourceId);\n        }\n        this.setAvatarVars(node, avatarUrl, initialLetter);\n    }\n\n    public get type(): IPillPart[\"type\"] {\n        return Type.RoomPill;\n    }\n\n    protected get className() {\n        return \"mx_Pill \" + (this.room.isSpaceRoom() ? \"mx_SpacePill\" : \"mx_RoomPill\");\n    }\n}\n\nclass AtRoomPillPart extends RoomPillPart {\n    constructor(text: string, room: Room) {\n        super(text, text, room);\n    }\n\n    public get type(): IPillPart[\"type\"] {\n        return Type.AtRoomPill;\n    }\n\n    public serialize(): ISerializedPillPart {\n        return {\n            type: this.type,\n            text: this.text,\n        };\n    }\n}\n\nclass UserPillPart extends PillPart {\n    constructor(userId, displayName, private member: RoomMember) {\n        super(userId, displayName);\n    }\n\n    public get type(): IPillPart[\"type\"] {\n        return Type.UserPill;\n    }\n\n    protected get className() {\n        return \"mx_UserPill mx_Pill\";\n    }\n\n    protected setAvatar(node: HTMLElement): void {\n        if (!this.member) {\n            return;\n        }\n        const name = this.member.name || this.member.userId;\n        const defaultAvatarUrl = Avatar.defaultAvatarUrlForString(this.member.userId);\n        const avatarUrl = Avatar.avatarUrlForMember(this.member, 16, 16, \"crop\");\n        let initialLetter = \"\";\n        if (avatarUrl === defaultAvatarUrl) {\n            initialLetter = Avatar.getInitialLetter(name);\n        }\n        this.setAvatarVars(node, avatarUrl, initialLetter);\n    }\n\n    protected onClick = (): void => {\n        defaultDispatcher.dispatch({\n            action: Action.ViewUser,\n            member: this.member,\n        });\n    };\n}\n\nclass PillCandidatePart extends PlainBasePart implements IPillCandidatePart {\n    constructor(text: string, private autoCompleteCreator: IAutocompleteCreator) {\n        super(text);\n    }\n\n    public createAutoComplete(updateCallback: UpdateCallback): AutocompleteWrapperModel {\n        return this.autoCompleteCreator.create(updateCallback);\n    }\n\n    protected acceptsInsertion(chr: string, offset: number, inputType: string): boolean {\n        if (offset === 0) {\n            return true;\n        } else {\n            return super.acceptsInsertion(chr, offset, inputType);\n        }\n    }\n\n    public merge(): boolean {\n        return false;\n    }\n\n    protected acceptsRemoval(position: number, chr: string): boolean {\n        return true;\n    }\n\n    get type(): IPillCandidatePart[\"type\"] {\n        return Type.PillCandidate;\n    }\n}\n\nexport function getAutoCompleteCreator(getAutocompleterComponent: GetAutocompleterComponent, updateQuery: UpdateQuery) {\n    return (partCreator: PartCreator) => {\n        return (updateCallback: UpdateCallback) => {\n            return new AutocompleteWrapperModel(\n                updateCallback,\n                getAutocompleterComponent,\n                updateQuery,\n                partCreator,\n            );\n        };\n    };\n}\n\ntype AutoCompleteCreator = ReturnType<typeof getAutoCompleteCreator>;\n\ninterface IAutocompleteCreator {\n    create(updateCallback: UpdateCallback): AutocompleteWrapperModel;\n}\n\nexport class PartCreator {\n    protected readonly autoCompleteCreator: IAutocompleteCreator;\n\n    constructor(\n        private readonly room: Room,\n        private readonly client: MatrixClient,\n        autoCompleteCreator: AutoCompleteCreator = null,\n    ) {\n        // pre-create the creator as an object even without callback so it can already be passed\n        // to PillCandidatePart (e.g. while deserializing) and set later on\n        this.autoCompleteCreator = { create: autoCompleteCreator?.(this) };\n    }\n\n    public setAutoCompleteCreator(autoCompleteCreator: AutoCompleteCreator): void {\n        this.autoCompleteCreator.create = autoCompleteCreator(this);\n    }\n\n    public createPartForInput(input: string, partIndex: number, inputType?: string): Part {\n        switch (input[0]) {\n            case \"#\":\n            case \"@\":\n            case \":\":\n            case \"+\":\n                return this.pillCandidate(\"\");\n            case \"\\n\":\n                return new NewlinePart();\n            default:\n                // We use lodash's grapheme splitter to avoid breaking apart compound emojis\n                if (EMOJIBASE_REGEX.test(split(input, \"\", 2)[0])) {\n                    return new EmojiPart();\n                }\n                return new PlainPart();\n        }\n    }\n\n    public createDefaultPart(text: string): Part {\n        return this.plain(text);\n    }\n\n    public deserializePart(part: SerializedPart): Part {\n        switch (part.type) {\n            case Type.Plain:\n                return this.plain(part.text);\n            case Type.Newline:\n                return this.newline();\n            case Type.Emoji:\n                return this.emoji(part.text);\n            case Type.AtRoomPill:\n                return this.atRoomPill(part.text);\n            case Type.PillCandidate:\n                return this.pillCandidate(part.text);\n            case Type.RoomPill:\n                return this.roomPill(part.resourceId);\n            case Type.UserPill:\n                return this.userPill(part.text, part.resourceId);\n        }\n    }\n\n    public plain(text: string): PlainPart {\n        return new PlainPart(text);\n    }\n\n    public newline(): NewlinePart {\n        return new NewlinePart(\"\\n\");\n    }\n\n    public emoji(text: string): EmojiPart {\n        return new EmojiPart(text);\n    }\n\n    public pillCandidate(text: string): PillCandidatePart {\n        return new PillCandidatePart(text, this.autoCompleteCreator);\n    }\n\n    public roomPill(alias: string, roomId?: string): RoomPillPart {\n        let room;\n        if (roomId || alias[0] !== \"#\") {\n            room = this.client.getRoom(roomId || alias);\n        } else {\n            room = this.client.getRooms().find((r) => {\n                return r.getCanonicalAlias() === alias ||\n                       r.getAltAliases().includes(alias);\n            });\n        }\n        return new RoomPillPart(alias, room ? room.name : alias, room);\n    }\n\n    public atRoomPill(text: string): AtRoomPillPart {\n        return new AtRoomPillPart(text, this.room);\n    }\n\n    public userPill(displayName: string, userId: string): UserPillPart {\n        const member = this.room.getMember(userId);\n        return new UserPillPart(userId, displayName, member);\n    }\n\n    public plainWithEmoji(text: string): (PlainPart | EmojiPart)[] {\n        const parts = [];\n        let plainText = \"\";\n\n        // We use lodash's grapheme splitter to avoid breaking apart compound emojis\n        for (const char of split(text, \"\")) {\n            if (EMOJIBASE_REGEX.test(char)) {\n                if (plainText) {\n                    parts.push(this.plain(plainText));\n                    plainText = \"\";\n                }\n                parts.push(this.emoji(char));\n            } else {\n                plainText += char;\n            }\n        }\n        if (plainText) {\n            parts.push(this.plain(plainText));\n        }\n        return parts;\n    }\n\n    public createMentionParts(\n        insertTrailingCharacter: boolean,\n        displayName: string,\n        userId: string,\n    ): [UserPillPart, PlainPart] {\n        const pill = this.userPill(displayName, userId);\n        if (!SettingsStore.getValue(\"MessageComposerInput.insertTrailingColon\")) {\n            insertTrailingCharacter = false;\n        }\n        const postfix = this.plain(insertTrailingCharacter ? \": \" : \" \");\n        return [pill, postfix];\n    }\n}\n\n// part creator that support auto complete for /commands,\n// used in SendMessageComposer\nexport class CommandPartCreator extends PartCreator {\n    public createPartForInput(text: string, partIndex: number): Part {\n        // at beginning and starts with /? create\n        if (partIndex === 0 && text[0] === \"/\") {\n            // text will be inserted by model, so pass empty string\n            return this.command(\"\");\n        } else {\n            return super.createPartForInput(text, partIndex);\n        }\n    }\n\n    public command(text: string): CommandPart {\n        return new CommandPart(text, this.autoCompleteCreator);\n    }\n\n    public deserializePart(part: SerializedPart): Part {\n        if (part.type === Type.Command) {\n            return this.command(part.text);\n        } else {\n            return super.deserializePart(part);\n        }\n    }\n}\n\nclass CommandPart extends PillCandidatePart {\n    public get type(): IPillCandidatePart[\"type\"] {\n        return Type.Command;\n    }\n}\n"],"mappings":"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"}