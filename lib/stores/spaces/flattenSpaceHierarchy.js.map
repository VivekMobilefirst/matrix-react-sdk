{"version":3,"file":"flattenSpaceHierarchy.js","names":["traverseSpaceDescendants","spaceDescendantMap","spaceId","flatSpace","Set","add","descendentSpaces","get","forEach","descendantSpaceId","has","flattenSpaceHierarchy","spaceEntityMap","flattenedSpaceIds","flattenedRooms","id","roomIds","flattenSpaceHierarchyWithCache","cache","useCache","result","set"],"sources":["../../../src/stores/spaces/flattenSpaceHierarchy.ts"],"sourcesContent":["/*\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { SpaceKey } from \".\";\n\nexport type SpaceEntityMap = Map<SpaceKey, Set<string>>;\nexport type SpaceDescendantMap = Map<SpaceKey, Set<SpaceKey>>;\n\nconst traverseSpaceDescendants = (\n    spaceDescendantMap: SpaceDescendantMap,\n    spaceId: SpaceKey,\n    flatSpace = new Set<SpaceKey>(),\n): Set<SpaceKey> => {\n    flatSpace.add(spaceId);\n    const descendentSpaces = spaceDescendantMap.get(spaceId);\n    descendentSpaces?.forEach(\n        descendantSpaceId => {\n            if (!flatSpace.has(descendantSpaceId)) {\n                traverseSpaceDescendants(spaceDescendantMap, descendantSpaceId, flatSpace);\n            }\n        },\n    );\n\n    return flatSpace;\n};\n\n/**\n * Helper function to traverse space hierarchy and flatten\n * @param spaceEntityMap ie map of rooms or dm userIds\n * @param spaceDescendantMap map of spaces and their children\n * @returns set of all rooms\n */\nexport const flattenSpaceHierarchy = (\n    spaceEntityMap: SpaceEntityMap,\n    spaceDescendantMap: SpaceDescendantMap,\n    spaceId: SpaceKey,\n): Set<string> => {\n    const flattenedSpaceIds = traverseSpaceDescendants(spaceDescendantMap, spaceId);\n    const flattenedRooms = new Set<string>();\n\n    flattenedSpaceIds.forEach(id => {\n        const roomIds = spaceEntityMap.get(id);\n        roomIds?.forEach(flattenedRooms.add, flattenedRooms);\n    });\n\n    return flattenedRooms;\n};\n\nexport const flattenSpaceHierarchyWithCache = (cache: SpaceEntityMap) => (\n    spaceEntityMap: SpaceEntityMap,\n    spaceDescendantMap: SpaceDescendantMap,\n    spaceId: SpaceKey,\n    useCache = true,\n): Set<string> => {\n    if (useCache && cache.has(spaceId)) {\n        return cache.get(spaceId);\n    }\n    const result = flattenSpaceHierarchy(spaceEntityMap, spaceDescendantMap, spaceId);\n    cache.set(spaceId, result);\n\n    return result;\n};\n\n"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA,MAAMA,wBAAwB,GAAG,UAC7BC,kBAD6B,EAE7BC,OAF6B,EAIb;EAAA,IADhBC,SACgB,uEADJ,IAAIC,GAAJ,EACI;EAChBD,SAAS,CAACE,GAAV,CAAcH,OAAd;EACA,MAAMI,gBAAgB,GAAGL,kBAAkB,CAACM,GAAnB,CAAuBL,OAAvB,CAAzB;EACAI,gBAAgB,EAAEE,OAAlB,CACIC,iBAAiB,IAAI;IACjB,IAAI,CAACN,SAAS,CAACO,GAAV,CAAcD,iBAAd,CAAL,EAAuC;MACnCT,wBAAwB,CAACC,kBAAD,EAAqBQ,iBAArB,EAAwCN,SAAxC,CAAxB;IACH;EACJ,CALL;EAQA,OAAOA,SAAP;AACH,CAhBD;AAkBA;AACA;AACA;AACA;AACA;AACA;;;AACO,MAAMQ,qBAAqB,GAAG,CACjCC,cADiC,EAEjCX,kBAFiC,EAGjCC,OAHiC,KAInB;EACd,MAAMW,iBAAiB,GAAGb,wBAAwB,CAACC,kBAAD,EAAqBC,OAArB,CAAlD;EACA,MAAMY,cAAc,GAAG,IAAIV,GAAJ,EAAvB;EAEAS,iBAAiB,CAACL,OAAlB,CAA0BO,EAAE,IAAI;IAC5B,MAAMC,OAAO,GAAGJ,cAAc,CAACL,GAAf,CAAmBQ,EAAnB,CAAhB;IACAC,OAAO,EAAER,OAAT,CAAiBM,cAAc,CAACT,GAAhC,EAAqCS,cAArC;EACH,CAHD;EAKA,OAAOA,cAAP;AACH,CAdM;;;;AAgBA,MAAMG,8BAA8B,GAAIC,KAAD,IAA2B,UACrEN,cADqE,EAErEX,kBAFqE,EAGrEC,OAHqE,EAKvD;EAAA,IADdiB,QACc,uEADH,IACG;;EACd,IAAIA,QAAQ,IAAID,KAAK,CAACR,GAAN,CAAUR,OAAV,CAAhB,EAAoC;IAChC,OAAOgB,KAAK,CAACX,GAAN,CAAUL,OAAV,CAAP;EACH;;EACD,MAAMkB,MAAM,GAAGT,qBAAqB,CAACC,cAAD,EAAiBX,kBAAjB,EAAqCC,OAArC,CAApC;EACAgB,KAAK,CAACG,GAAN,CAAUnB,OAAV,EAAmBkB,MAAnB;EAEA,OAAOA,MAAP;AACH,CAbM"}